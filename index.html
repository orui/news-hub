<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“° News Hub - æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¾ã¨ã‚ã‚µã‚¤ãƒˆ</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤‡æ•°ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰è‡ªå‹•å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹å‹•çš„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¾ã¨ã‚ã‚µã‚¤ãƒˆ">
    <meta name="keywords" content="ãƒ‹ãƒ¥ãƒ¼ã‚¹, æœ€æ–°æƒ…å ±, ã¾ã¨ã‚, RSS, å‹•çš„æ›´æ–°">
    <meta name="author" content="News Hub">
    
    <!-- Open Graph -->
    <meta property="og:title" content="News Hub - æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¾ã¨ã‚ã‚µã‚¤ãƒˆ">
    <meta property="og:description" content="è¤‡æ•°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚½ãƒ¼ã‚¹ã‹ã‚‰æœ€æ–°æƒ…å ±ã‚’è‡ªå‹•å–å¾—">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://orui.github.io/news-hub/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“°</text></svg>">
    
    <style>
        /* CSS Variables for Theme */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --accent-color: #f59e0b;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --border-color: #334155;
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: all 0.3s ease;
        }

        /* Header */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo-icon {
            margin-right: 0.5rem;
            font-size: 2rem;
        }

        /* Navigation */
        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--primary-color);
            background: var(--bg-secondary);
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-width: 200px;
        }

        .search-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: var(--bg-secondary);
        }

        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Category Filter */
        .category-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .category-btn:hover,
        .category-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* News Grid */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* News Card */
        .news-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .news-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .news-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 3rem;
        }

        .news-content {
            padding: 1.5rem;
        }

        .news-category {
            display: inline-block;
            background: var(--accent-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .news-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .news-title a {
            color: var(--text-primary);
            text-decoration: none;
        }

        .news-title a:hover {
            color: var(--primary-color);
        }

        .news-summary {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .news-source {
            font-weight: 500;
        }

        .news-time {
            font-style: italic;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Messages */
        .status-message {
            text-align: center;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            margin: 2rem 0;
        }

        .error-message {
            color: #dc2626;
        }

        .success-message {
            color: #059669;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav {
                gap: 1rem;
            }

            .search-input {
                min-width: 150px;
            }

            .main {
                padding: 1rem;
            }

            .news-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles */
        button:focus,
        input:focus,
        a:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
    
      /* ğŸŒ¤ï¸ Weather Widget Styles */
      .weather-widget {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
      }

      .weather-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
      }

      .weather-header h3 {
        margin: 0;
        color: var(--primary-color);
        font-size: 1.2rem;
      }

      .weather-header small {
        color: var(--text-secondary);
        font-size: 0.8rem;
      }

      .weather-current {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .weather-main {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .weather-temp {
        font-size: 2rem;
        font-weight: bold;
        color: var(--accent-color);
      }

      .weather-condition {
        color: var(--text-primary);
        font-size: 1rem;
      }

      .weather-details {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .weather-forecast {
        border-top: 1px solid var(--border-color);
        padding-top: 1rem;
      }

      .weather-forecast h4 {
        margin: 0 0 0.75rem 0;
        font-size: 1rem;
        color: var(--text-primary);
      }

      .forecast-list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
      }

      .forecast-item {
        background: var(--bg-secondary);
        padding: 0.75rem;
        border-radius: 8px;
        text-align: center;
        font-size: 0.8rem;
      }

      .forecast-date {
        font-weight: bold;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
      }

      .forecast-condition {
        color: var(--text-secondary);
        margin-bottom: 0.25rem;
      }

      .forecast-temp {
        color: var(--primary-color);
        font-weight: bold;
      }

      /* ğŸ“ˆ Weight Chart Widget Styles */
      .weight-widget {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
      }

      .weight-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
      }

      .weight-header h3 {
        margin: 0;
        color: var(--primary-color);
        font-size: 1.2rem;
      }

      .weight-header small {
        color: var(--text-secondary);
        font-size: 0.8rem;
      }

      .weight-chart {
        text-align: center;
        margin-bottom: 1rem;
      }

      .weight-chart-img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .weight-chart-img:hover {
        transform: scale(1.02);
      }

      .weight-chart-img.enlarged {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(1.5);
        z-index: 9999;
        background: var(--bg-primary);
        padding: 1rem;
        border-radius: 10px;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        cursor: zoom-out;
      }

      .weight-info {
        background: var(--bg-secondary);
        padding: 1rem;
        border-radius: 8px;
      }

      .weight-note {
        color: var(--text-secondary);
        font-size: 0.85rem;
        line-height: 1.4;
      }

      /* ğŸ›ï¸ Dashboard Layout */
      .dashboard-widgets {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      /* ğŸ“± Responsive adjustments */
      @media (max-width: 768px) {
        .weather-current {
          grid-template-columns: 1fr;
        }
        
        .forecast-list {
          grid-template-columns: 1fr;
        }
        
        .dashboard-widgets {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
        
        .weight-chart-img.enlarged {
          transform: translate(-50%, -50%) scale(1.2);
          width: 95vw;
          height: auto;
        }
      }

      /* ğŸ” Authentication styles are already included in the auth system */
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo">
                <span class="logo-icon">ğŸ“°</span>
                <span>News Hub</span>
            </a>
            
            <nav class="nav">
                <a href="#" class="nav-item active" data-category="all">ã™ã¹ã¦</a>
                <a href="#" class="nav-item" data-category="business">ãƒ“ã‚¸ãƒã‚¹</a>
                <a href="#" class="nav-item" data-category="technology">ãƒ†ãƒƒã‚¯</a>
                <a href="#" class="nav-item" data-category="world">å›½éš›</a>
                <a href="#" class="nav-item" data-category="sports">ã‚¹ãƒãƒ¼ãƒ„</a>
            </nav>
            
            <div class="controls">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ¤œç´¢..." id="searchInput">
                    <button class="search-btn" id="searchBtn" aria-label="æ¤œç´¢">ğŸ”</button>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">ğŸŒ™</button>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="category-filter" id="categoryFilter">
            <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ã¯JavaScriptã§ç”Ÿæˆ -->
        </section>

        <section class="news-grid" id="newsGrid">
            <div class="loading">
                <div class="spinner"></div>
                <p>æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </section>

        <div class="status-message" id="statusMessage" style="display: none;">
            <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        </div>
    </main>

    <script>
        // News Hub Application
        class NewsHub {
            constructor() {
                this.currentCategory = 'all';
                this.searchTerm = '';
                this.newsData = [];
                this.newsSources = []; // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚½ãƒ¼ã‚¹ã¯å¾Œã§è¨­å®š
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupTheme();
                this.showPlaceholderNews();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.selectCategory(e.target.dataset.category);
                    });
                });

                // Search
                document.getElementById('searchBtn').addEventListener('click', () => {
                    this.performSearch();
                });
                
                document.getElementById('searchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });

                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.toggleTheme();
                });

                // Auto-refresh every 5 minutes
                setInterval(() => {
                    this.loadNews();
                }, 30 * 60 * 1000);
            }

            setupTheme() {
                const savedTheme = localStorage.getItem('newsHubTheme');
                const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme) {
                    this.setTheme(savedTheme);
                } else if (systemDark) {
                    this.setTheme('dark');
                }

                // System theme change listener
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (!localStorage.getItem('newsHubTheme')) {
                        this.setTheme(e.matches ? 'dark' : 'light');
                    }
                });
            }

            setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                document.getElementById('themeToggle').innerHTML = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('newsHubTheme', theme);
            }

            toggleTheme() {
                const current = document.documentElement.getAttribute('data-theme');
                this.setTheme(current === 'dark' ? 'light' : 'dark');
            }

            selectCategory(category) {
                this.currentCategory = category;
                
                // Update nav active state
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.category === category);
                });

                this.filterNews();
            }

            performSearch() {
                this.searchTerm = document.getElementById('searchInput').value.toLowerCase();
                this.filterNews();
            }

            filterNews() {
                const filtered = this.newsData.filter(news => {
                    const categoryMatch = this.currentCategory === 'all' || news.category === this.currentCategory;
                    const searchMatch = !this.searchTerm || 
                        news.title.toLowerCase().includes(this.searchTerm) ||
                        news.summary.toLowerCase().includes(this.searchTerm);
                    
                    return categoryMatch && searchMatch;
                });

                this.renderNews(filtered);
            }

            async loadNews() {
                // This method will be updated when news sources are provided
                console.log('ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—æ©Ÿèƒ½ã¯è¨­å®šå¾…ã¡ã§ã™');
                this.showStatusMessage('ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚½ãƒ¼ã‚¹ã®è¨­å®šã‚’ãŠå¾…ã¡ãã ã•ã„', 'info');
            }

            showPlaceholderNews() {
                // Placeholder news data
                const placeholderNews = [
                    {
                        title: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚½ãƒ¼ã‚¹è¨­å®šå¾…ã¡',
                        summary: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚½ãƒ¼ã‚¹ãŒè¨­å®šã•ã‚Œã‚‹ã¨ã€ã“ã“ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚',
                        category: 'info',
                        source: 'News Hub',
                        time: 'æº–å‚™ä¸­',
                        url: '#',
                        image: null
                    },
                    {
                        title: 'å‹•çš„ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—æ©Ÿèƒ½',
                        summary: 'RSS/APIã‹ã‚‰ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è‡ªå‹•å–å¾—ã—ã¦ã€ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’æ­è¼‰äºˆå®šã§ã™ã€‚',
                        category: 'technology',
                        source: 'ã‚·ã‚¹ãƒ†ãƒ ',
                        time: 'é–‹ç™ºä¸­',
                        url: '#',
                        image: null
                    },
                    {
                        title: 'ãƒ¢ãƒ€ãƒ³ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆ',
                        summary: 'ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€æ¤œç´¢æ©Ÿèƒ½ã‚’å‚™ãˆãŸãƒ¢ãƒ€ãƒ³ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆã§ã™ã€‚',
                        category: 'business',
                        source: 'News Hub',
                        time: 'å®Ÿè£…æ¸ˆã¿',
                        url: '#',
                        image: null
                    }
                ];

                this.newsData = placeholderNews;
                this.renderNews(placeholderNews);
            }

            renderNews(newsArray) {
                const grid = document.getElementById('newsGrid');
                
                if (newsArray.length === 0) {
                    grid.innerHTML = '<div class="status-message">è©²å½“ã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>';
                    return;
                }

                grid.innerHTML = newsArray.map(news => `
                    <article class="news-card">
                        ${news.image ? 
                            `<img src="${news.image}" alt="${news.title}" class="news-image">` :
                            `<div class="news-image">ğŸ“°</div>`
                        }
                        <div class="news-content">
                            <span class="news-category">${this.getCategoryLabel(news.category)}</span>
                            <h2 class="news-title">
                                <a href="${news.url}" target="_blank" rel="noopener noreferrer">${news.title}</a>
                            </h2>
                            <p class="news-summary">${news.summary}</p>
                            <div class="news-meta">
                                <span class="news-source">${news.source}</span>
                                <time class="news-time">${news.time}</time>
                            </div>
                        </div>
                    </article>
                `).join('');
            }

            getCategoryLabel(category) {
                const labels = {
                    'all': 'ã™ã¹ã¦',
                    'business': 'ãƒ“ã‚¸ãƒã‚¹',
                    'technology': 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼',
                    'world': 'å›½éš›',
                    'sports': 'ã‚¹ãƒãƒ¼ãƒ„',
                    'entertainment': 'ã‚¨ãƒ³ã‚¿ãƒ¡',
                    'info': 'æƒ…å ±'
                };
                return labels[category] || category;
            }

            showStatusMessage(message, type = 'info') {
                const statusDiv = document.getElementById('statusMessage');
                statusDiv.innerHTML = message;
                statusDiv.className = `status-message ${type}-message`;
                statusDiv.style.display = 'block';
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }

            // Method to update news sources (will be called when sources are provided)
            updateNewsSources(sources) {
                this.newsSources = sources;
                this.loadNews();
            }
        }

        // Initialize News Hub
        const newsHub = new NewsHub();
        
        // Global function for updating news sources
        window.updateNewsSources = (sources) => {
            newsHub.updateNewsSources(sources);
        };

        // Console message
        console.log('ğŸ“° News Hub initialized. Waiting for news sources configuration.');
    </script>

        <script>
        
    // ğŸ“° News Scraping System with Proxy
    class NewsScrapingSystem {
      constructor() {
        this.proxyEndpoint = 'https://api.allorigins.win/get'; // CORS proxy
        this.newsSources = [
          {
            name: 'Yahoo!ãƒ‹ãƒ¥ãƒ¼ã‚¹',
            url: 'https://news.yahoo.co.jp/',
            category: 'general',
            selector: '.newsFeed_item',
            titleSelector: '.newsFeed_item_title',
            linkSelector: 'a',
            timeSelector: '.newsFeed_item_date'
          },
          {
            name: 'ITmedia',
            url: 'https://www.itmedia.co.jp/',
            category: 'technology',
            selector: '.colBoxBody li',
            titleSelector: 'a',
            linkSelector: 'a',
            timeSelector: '.date'
          },
          {
            name: 'CNET Japan',
            url: 'https://japan.cnet.com/',
            category: 'technology',
            selector: '.latestList li',
            titleSelector: '.latestList_link',
            linkSelector: 'a',
            timeSelector: '.latestList_date'
          }
        ];
        this.cache = new Map();
        this.cacheTimeout = 30 * 60 * 1000; // 5åˆ†
      }

      async fetchWithProxy(url) {
        try {
          const proxyUrl = `${this.proxyEndpoint}?url=${encodeURIComponent(url)}`;
          const response = await fetch(proxyUrl);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          return data.contents;
        } catch (error) {
          console.error('Proxy fetch error:', error);
          return null;
        }
      }

      parseHTML(htmlString) {
        const parser = new DOMParser();
        return parser.parseFromString(htmlString, 'text/html');
      }

      extractNewsFromSource(source, doc) {
        const articles = [];
        
        try {
          const newsItems = doc.querySelectorAll(source.selector);
          
          newsItems.forEach((item, index) => {
            if (index >= 10) return; // æœ€å¤§10ä»¶ã¾ã§
            
            const titleElement = item.querySelector(source.titleSelector);
            const linkElement = item.querySelector(source.linkSelector);
            const timeElement = item.querySelector(source.timeSelector);
            
            if (titleElement && linkElement) {
              const title = titleElement.textContent.trim();
              const link = linkElement.href || linkElement.getAttribute('href');
              const time = timeElement ? timeElement.textContent.trim() : 'æ™‚é–“ä¸æ˜';
              
              // ç›¸å¯¾URLã‚’çµ¶å¯¾URLã«å¤‰æ›
              const absoluteLink = link.startsWith('http') ? 
                link : 
                new URL(link, source.url).href;
              
              articles.push({
                title: title,
                summary: this.generateSummary(title),
                category: source.category,
                source: source.name,
                time: this.formatTime(time),
                url: absoluteLink,
                image: null
              });
            }
          });
        } catch (error) {
          console.error(`Error extracting from ${source.name}:`, error);
        }
        
        return articles;
      }

      generateSummary(title) {
        // ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ç°¡æ˜“è¦ç´„ã‚’ç”Ÿæˆ
        return title.length > 50 ? 
          title.substring(0, 50) + '...' : 
          title;
      }

      formatTime(timeString) {
        // æ™‚é–“è¡¨ç¤ºã‚’çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›
        const now = new Date();
        
        if (timeString.includes('åˆ†å‰')) {
          const minutes = parseInt(timeString.match(/\d+/)?.[0] || '0');
          return `${minutes}åˆ†å‰`;
        } else if (timeString.includes('æ™‚é–“å‰')) {
          const hours = parseInt(timeString.match(/\d+/)?.[0] || '0');
          return `${hours}æ™‚é–“å‰`;
        } else if (timeString.includes('æ—¥å‰')) {
          const days = parseInt(timeString.match(/\d+/)?.[0] || '0');
          return `${days}æ—¥å‰`;
        } else if (timeString.match(/\d{1,2}:\d{2}/)) {
          return timeString;
        }
        
        return timeString || `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
      }

      async loadNewsFromSource(source) {
        const cacheKey = source.name;
        const cached = this.cache.get(cacheKey);
        
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
        if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
          return cached.articles;
        }
        
        console.log(`ğŸ“° Loading news from ${source.name}...`);
        
        const htmlContent = await this.fetchWithProxy(source.url);
        if (!htmlContent) {
          return [];
        }
        
        const doc = this.parseHTML(htmlContent);
        const articles = this.extractNewsFromSource(source, doc);
        
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
        this.cache.set(cacheKey, {
          articles: articles,
          timestamp: Date.now()
        });
        
        return articles;
      }

      async loadAllNews() {
        console.log('ğŸ”„ Loading news from all sources...');
        
        const allArticles = [];
        const promises = this.newsSources.map(source => this.loadNewsFromSource(source));
        
        try {
          const results = await Promise.allSettled(promises);
          
          results.forEach((result, index) => {
            if (result.status === 'fulfilled') {
              allArticles.push(...result.value);
            } else {
              console.error(`Failed to load from ${this.newsSources[index].name}:`, result.reason);
            }
          });
          
          // é‡è¤‡é™¤å»ã¨ã‚½ãƒ¼ãƒˆ
          const uniqueArticles = this.removeDuplicates(allArticles);
          const sortedArticles = this.sortByTime(uniqueArticles);
          
          console.log(`âœ… Loaded ${sortedArticles.length} articles from ${this.newsSources.length} sources`);
          return sortedArticles;
          
        } catch (error) {
          console.error('Error loading news:', error);
          return [];
        }
      }

      removeDuplicates(articles) {
        const seen = new Set();
        return articles.filter(article => {
          const key = article.title + article.source;
          if (seen.has(key)) {
            return false;
          }
          seen.add(key);
          return true;
        });
      }

      sortByTime(articles) {
        return articles.sort((a, b) => {
          // ç°¡æ˜“çš„ãªæ™‚é–“ã‚½ãƒ¼ãƒˆï¼ˆå®Ÿéš›ã®æ™‚åˆ»è§£æã¯è¤‡é›‘ï¼‰
          if (a.time.includes('åˆ†å‰') && b.time.includes('åˆ†å‰')) {
            const aMinutes = parseInt(a.time.match(/\d+/)?.[0] || '0');
            const bMinutes = parseInt(b.time.match(/\d+/)?.[0] || '0');
            return aMinutes - bMinutes;
          }
          return 0; // ãã®ä»–ã¯å…ƒã®é †åºã‚’ç¶­æŒ
        });
      }

      // æ—¥çµŒæ–°èå°‚ç”¨ã®ç‰¹åˆ¥ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆæ³¨æ„äº‹é …ä»˜ãï¼‰
      async loadNikkeiNews() {
        console.warn('âš ï¸  Nikkei scraping: Please ensure compliance with terms of service');
        
        const nikkeiSource = {
          name: 'æ—¥æœ¬çµŒæ¸ˆæ–°è',
          url: 'https://www.nikkei.com/',
          category: 'business',
          selector: '.m-miM09_item, .m-miM09-listWrap_item',
          titleSelector: '.m-miM09_titleText, .m-miM09-listWrap_title',
          linkSelector: 'a',
          timeSelector: '.m-miM09_date, .m-miM09-listWrap_date'
        };
        
        return await this.loadNewsFromSource(nikkeiSource);
      }
    }

    // News Hubã«çµ±åˆ
    if (typeof window !== 'undefined' && window.newsHub) {
      window.newsHub.scrapingSystem = new NewsScrapingSystem();
      
      // æ—¢å­˜ã®loadNews methodã‚’ç½®ãæ›ãˆ
      window.newsHub.loadNews = async function() {
        const articles = await this.scrapingSystem.loadAllNews();
        this.newsData = articles;
        this.filterNews();
        
        if (articles.length > 0) {
          this.showStatusMessage(`ğŸ“° ${articles.length}ä»¶ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¾ã—ãŸ`, 'success');
        } else {
          this.showStatusMessage('ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
      };
      
      // æ—¥çµŒãƒ‹ãƒ¥ãƒ¼ã‚¹å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
      window.newsHub.loadNikkeiNews = async function() {
        const articles = await this.scrapingSystem.loadNikkeiNews();
        this.newsData = [...this.newsData, ...articles];
        this.filterNews();
        
        this.showStatusMessage(`ğŸ“Š æ—¥çµŒãƒ‹ãƒ¥ãƒ¼ã‚¹ ${articles.length}ä»¶ã‚’è¿½åŠ ã—ã¾ã—ãŸ`, 'success');
      };
      
      // è‡ªå‹•èª­ã¿è¾¼ã¿é–‹å§‹
      setTimeout(() => {
        window.newsHub.loadNews();
      }, 1000);
      
      console.log('ğŸ”„ News scraping system integrated successfully');
    }
    
        </script>
        
        <script>
        
    // ğŸŒ Alternative News API Sources (Legal & Free)
    class NewsAPISystem {
      constructor() {
        this.apiSources = [
          {
            name: 'NewsAPI (Free)',
            url: 'https://newsapi.org/v2/top-headlines',
            params: {
              country: 'jp',
              apiKey: '37bec8593888416299df95ed455407f8', // ç„¡æ–™ç™»éŒ²ã§å–å¾—
              pageSize: 10
            },
            category: 'general'
          },
          {
            name: 'Guardian API',
            url: 'https://content.guardianapis.com/search',
            params: {
              'api-key': 'test', // testã‚­ãƒ¼ã§ã‚‚åˆ©ç”¨å¯èƒ½
              'show-fields': 'headline,thumbnail,short-url',
              pageSize: 10
            },
            category: 'international'
          },
          {
            name: 'Reddit API (Tech News)',
            url: 'https://www.reddit.com/r/technology/.json',
            params: {
              limit: 10
            },
            category: 'technology'
          }
        ];
      }

      async loadFromAPI(source) {
        try {
          const url = new URL(source.url);
          Object.entries(source.params).forEach(([key, value]) => {
            url.searchParams.set(key, value);
          });

          const response = await fetch(url.toString());
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          return this.parseAPIResponse(data, source);
        } catch (error) {
          console.error(`Error loading from ${source.name}:`, error);
          return [];
        }
      }

      parseAPIResponse(data, source) {
        const articles = [];
        
        try {
          if (source.name === 'NewsAPI (Free)' && data.articles) {
            data.articles.forEach(article => {
              articles.push({
                title: article.title,
                summary: article.description || article.title,
                category: source.category,
                source: article.source.name,
                time: this.formatAPITime(article.publishedAt),
                url: article.url,
                image: article.urlToImage
              });
            });
          } else if (source.name === 'Guardian API' && data.response?.results) {
            data.response.results.forEach(article => {
              articles.push({
                title: article.webTitle,
                summary: article.fields?.headline || article.webTitle,
                category: source.category,
                source: 'The Guardian',
                time: this.formatAPITime(article.webPublicationDate),
                url: article.webUrl,
                image: article.fields?.thumbnail
              });
            });
          } else if (source.name.includes('Reddit') && data.data?.children) {
            data.data.children.forEach(post => {
              const postData = post.data;
              articles.push({
                title: postData.title,
                summary: postData.selftext?.substring(0, 100) + '...' || postData.title,
                category: source.category,
                source: 'Reddit',
                time: this.formatAPITime(new Date(postData.created_utc * 1000).toISOString()),
                url: `https://reddit.com${postData.permalink}`,
                image: postData.thumbnail !== 'self' ? postData.thumbnail : null
              });
            });
          }
        } catch (error) {
          console.error('Error parsing API response:', error);
        }
        
        return articles;
      }

      formatAPITime(timeString) {
        try {
          const date = new Date(timeString);
          const now = new Date();
          const diffMs = now - date;
          const diffMins = Math.floor(diffMs / 60000);
          const diffHours = Math.floor(diffMs / 3600000);
          const diffDays = Math.floor(diffMs / 86400000);
          
          if (diffMins < 60) {
            return `${diffMins}åˆ†å‰`;
          } else if (diffHours < 24) {
            return `${diffHours}æ™‚é–“å‰`;
          } else {
            return `${diffDays}æ—¥å‰`;
          }
        } catch (error) {
          return 'æ™‚é–“ä¸æ˜';
        }
      }

      async loadAllAPINews() {
        const allArticles = [];
        const promises = this.apiSources.map(source => this.loadFromAPI(source));
        
        try {
          const results = await Promise.allSettled(promises);
          
          results.forEach((result, index) => {
            if (result.status === 'fulfilled') {
              allArticles.push(...result.value);
            } else {
              console.error(`Failed to load from API ${this.apiSources[index].name}:`, result.reason);
            }
          });
          
          return allArticles;
        } catch (error) {
          console.error('Error loading API news:', error);
          return [];
        }
      }
    }

    // ä½¿ç”¨æ–¹æ³•ã®èª¬æ˜
    console.log(`
ğŸ“° News API Integration Guide:

1. NewsAPI.org (ç„¡æ–™):
   - ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—: https://newsapi.org/
   - ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ—¥
   - æ—¥æœ¬ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—å¯èƒ½

2. Guardian API (ç„¡æ–™):
   - å›½éš›ãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼ˆè‹±èªï¼‰
   - API Keyä¸è¦ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

3. Reddit API (ç„¡æ–™):
   - ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ç³»ãƒ‹ãƒ¥ãƒ¼ã‚¹
   - èªè¨¼ä¸è¦

æ¨å¥¨: NewsAPI.orgã§ç„¡æ–™API Keyã‚’å–å¾—
`);
    
        </script>
        
        <script>
        
    // ğŸ”‘ NewsAPI Integration with Real API Key
    class NewsAPIIntegration {
      constructor() {
        this.apiKey = '37bec8593888416299df95ed455407f8';
        this.baseUrl = 'https://newsapi.org/v2';
        this.proxyUrl = 'https://api.allorigins.win/get';
        this.cache = new Map();
        this.cacheTimeout = 10 * 60 * 1000; // 10åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      }

      async fetchWithCORS(url) {
        try {
          const proxyUrl = `${this.proxyUrl}?url=${encodeURIComponent(url)}`;
          const response = await fetch(proxyUrl);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          return JSON.parse(data.contents);
        } catch (error) {
          console.error('NewsAPI fetch error:', error);
          return null;
        }
      }

      async getTopHeadlines(category = null, country = 'jp') {
        const cacheKey = `headlines-${category || 'general'}-${country}`;
        const cached = this.cache.get(cacheKey);
        
        if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
          return cached.articles;
        }

        console.log(`ğŸ“° Fetching ${category ? category + ' ' : ''}headlines from NewsAPI...`);

        const url = new URL(`${this.baseUrl}/top-headlines`);
        url.searchParams.set('apiKey', this.apiKey);
        url.searchParams.set('country', country);
        url.searchParams.set('pageSize', '20');
        
        if (category && category !== 'general') {
          url.searchParams.set('category', category);
        }

        try {
          const data = await this.fetchWithCORS(url.toString());
          
          if (!data || data.status !== 'ok') {
            console.error('NewsAPI error:', data?.message || 'Unknown error');
            return [];
          }

          const articles = this.parseNewsAPIResponse(data, category || 'general');
          
          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
          this.cache.set(cacheKey, {
            articles: articles,
            timestamp: Date.now()
          });

          return articles;
        } catch (error) {
          console.error('Error fetching headlines:', error);
          return [];
        }
      }

      async getEverything(query, language = 'jp') {
        const cacheKey = `everything-${query}-${language}`;
        const cached = this.cache.get(cacheKey);
        
        if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
          return cached.articles;
        }

        console.log(`ğŸ” Searching NewsAPI for: ${query}`);

        const url = new URL(`${this.baseUrl}/everything`);
        url.searchParams.set('apiKey', this.apiKey);
        url.searchParams.set('q', query);
        url.searchParams.set('language', language);
        url.searchParams.set('sortBy', 'publishedAt');
        url.searchParams.set('pageSize', '15');

        try {
          const data = await this.fetchWithCORS(url.toString());
          
          if (!data || data.status !== 'ok') {
            console.error('NewsAPI search error:', data?.message || 'Unknown error');
            return [];
          }

          const articles = this.parseNewsAPIResponse(data, 'search');
          
          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
          this.cache.set(cacheKey, {
            articles: articles,
            timestamp: Date.now()
          });

          return articles;
        } catch (error) {
          console.error('Error searching news:', error);
          return [];
        }
      }

      parseNewsAPIResponse(data, category) {
        const articles = [];
        
        if (data.articles && Array.isArray(data.articles)) {
          data.articles.forEach(article => {
            // ç„¡åŠ¹ãªè¨˜äº‹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            if (!article.title || article.title === '[Removed]' || 
                !article.url || article.url.includes('removed.com')) {
              return;
            }

            articles.push({
              title: this.cleanTitle(article.title),
              summary: this.cleanSummary(article.description || article.title),
              category: this.mapCategory(category),
              source: this.cleanSourceName(article.source?.name || 'NewsAPI'),
              time: this.formatTime(article.publishedAt),
              url: article.url,
              image: article.urlToImage && article.urlToImage !== 'null' ? article.urlToImage : null,
              author: article.author
            });
          });
        }

        return articles;
      }

      cleanTitle(title) {
        if (!title) return 'ã‚¿ã‚¤ãƒˆãƒ«ä¸æ˜';
        return title.replace(/\s+/g, ' ').trim().substring(0, 100);
      }

      cleanSummary(description) {
        if (!description) return '';
        return description.replace(/\s+/g, ' ').trim().substring(0, 150) + 
               (description.length > 150 ? '...' : '');
      }

      cleanSourceName(sourceName) {
        if (!sourceName) return 'Unknown';
        return sourceName.replace(/\.com$/, '').trim();
      }

      mapCategory(apiCategory) {
        const categoryMap = {
          'general': 'general',
          'business': 'business',
          'technology': 'technology',
          'science': 'technology',
          'health': 'health',
          'sports': 'sports',
          'entertainment': 'entertainment',
          'search': 'general'
        };
        
        return categoryMap[apiCategory] || 'general';
      }

      formatTime(publishedAt) {
        try {
          const date = new Date(publishedAt);
          const now = new Date();
          const diffMs = now - date;
          const diffMins = Math.floor(diffMs / 60000);
          const diffHours = Math.floor(diffMs / 3600000);
          const diffDays = Math.floor(diffMs / 86400000);
          
          if (diffMins < 1) {
            return 'ãŸã£ãŸä»Š';
          } else if (diffMins < 60) {
            return `${diffMins}åˆ†å‰`;
          } else if (diffHours < 24) {
            return `${diffHours}æ™‚é–“å‰`;
          } else if (diffDays < 7) {
            return `${diffDays}æ—¥å‰`;
          } else {
            return date.toLocaleDateString('ja-JP', {
              month: 'short',
              day: 'numeric'
            });
          }
        } catch (error) {
          return 'æ™‚é–“ä¸æ˜';
        }
      }

      async loadAllCategories() {
        console.log('ğŸ“Š Loading news from all NewsAPI categories...');
        
        const categories = ['general', 'business', 'technology', 'sports', 'health'];
        const promises = categories.map(cat => this.getTopHeadlines(cat));
        
        try {
          const results = await Promise.allSettled(promises);
          const allArticles = [];
          
          results.forEach((result, index) => {
            if (result.status === 'fulfilled') {
              allArticles.push(...result.value);
              console.log(`âœ… ${categories[index]}: ${result.value.length} articles`);
            } else {
              console.error(`âŒ ${categories[index]} failed:`, result.reason);
            }
          });
          
          // é‡è¤‡é™¤å»
          const uniqueArticles = this.removeDuplicates(allArticles);
          console.log(`ğŸ“° Total unique articles: ${uniqueArticles.length}`);
          
          return uniqueArticles;
        } catch (error) {
          console.error('Error loading all categories:', error);
          return [];
        }
      }

      removeDuplicates(articles) {
        const seen = new Set();
        return articles.filter(article => {
          const key = article.title + article.source;
          if (seen.has(key)) {
            return false;
          }
          seen.add(key);
          return true;
        });
      }

      // APIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
      async checkAPIStatus() {
        try {
          const url = `${this.baseUrl}/top-headlines?country=us&pageSize=1&apiKey=${this.apiKey}`;
          const data = await this.fetchWithCORS(url);
          
          if (data && data.status === 'ok') {
            console.log('âœ… NewsAPI connection successful');
            return true;
          } else {
            console.error('âŒ NewsAPI connection failed:', data?.message);
            return false;
          }
        } catch (error) {
          console.error('âŒ NewsAPI status check error:', error);
          return false;
        }
      }
    }

    // News Hubã«çµ±åˆ
    if (typeof window !== 'undefined' && window.newsHub) {
      window.newsHub.newsAPI = new NewsAPIIntegration();
      
      // æ—¢å­˜ã®loadNews methodã‚’æ‹¡å¼µ
      const originalLoadNews = window.newsHub.loadNews;
      
      window.newsHub.loadNews = async function() {
        try {
          console.log('ğŸš€ Loading news from enhanced sources...');
          this.showStatusMessage('ğŸ“° æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ä¸­...', 'info');
          
          // NewsAPIã‹ã‚‰ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—
          const newsAPIArticles = await this.newsAPI.loadAllCategories();
          
          // æ—¢å­˜ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°çµæœã¨çµ±åˆ
          let scrapingArticles = [];
          if (this.scrapingSystem) {
            scrapingArticles = await this.scrapingSystem.loadAllNews();
          }
          
          // çµæœã‚’çµ±åˆ
          const allArticles = [...newsAPIArticles, ...scrapingArticles];
          const uniqueArticles = this.removeDuplicatesByTitle(allArticles);
          
          this.newsData = uniqueArticles;
          this.filterNews();
          
          if (uniqueArticles.length > 0) {
            this.showStatusMessage(
              `ğŸ“° ${uniqueArticles.length}ä»¶ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¾ã—ãŸ (NewsAPI: ${newsAPIArticles.length}ä»¶, ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°: ${scrapingArticles.length}ä»¶)`, 
              'success'
            );
          } else {
            this.showStatusMessage('ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
          }
        } catch (error) {
          console.error('Error loading news:', error);
          this.showStatusMessage('ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
      };
      
      // é‡è¤‡é™¤å»ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
      window.newsHub.removeDuplicatesByTitle = function(articles) {
        const seen = new Set();
        return articles.filter(article => {
          const key = article.title.toLowerCase().replace(/[^a-z0-9]/g, '');
          if (seen.has(key)) {
            return false;
          }
          seen.add(key);
          return true;
        });
      };
      
      // NewsAPIæ¤œç´¢æ©Ÿèƒ½è¿½åŠ 
      window.newsHub.searchNewsAPI = async function(query) {
        if (!query) return;
        
        console.log(`ğŸ” Searching NewsAPI for: ${query}`);
        this.showStatusMessage(`ğŸ” "${query}" ã‚’æ¤œç´¢ä¸­...`, 'info');
        
        const searchResults = await this.newsAPI.getEverything(query);
        
        if (searchResults.length > 0) {
          this.newsData = [...this.newsData, ...searchResults];
          this.filterNews();
          this.showStatusMessage(`ğŸ” "${query}" ã®æ¤œç´¢çµæœ: ${searchResults.length}ä»¶`, 'success');
        } else {
          this.showStatusMessage(`ğŸ” "${query}" ã®æ¤œç´¢çµæœã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`, 'info');
        }
      };
      
      // APIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
      setTimeout(async () => {
        const status = await window.newsHub.newsAPI.checkAPIStatus();
        if (status) {
          console.log('ğŸ”‘ NewsAPI Key verified and working');
        }
      }, 500);
      
      console.log('ğŸ”‘ NewsAPI integration completed successfully');
      console.log('ğŸ“Š Available categories: general, business, technology, sports, health');
    }
    
        </script>
        
        <script>
        
    // ğŸ” Basic Authentication System
    class BasicAuthSystem {
      constructor() {
        this.authenticated = false;
        this.credentials = {
          username: 'hisao',
          password: 'newshub2026'  // ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å¤‰æ›´å¯èƒ½
        };
        this.sessionTimeout = 4 * 60 * 60 * 1000; // 4æ™‚é–“
        this.init();
      }

      init() {
        this.checkAuthStatus();
        this.setupAuthUI();
      }

      checkAuthStatus() {
        const authData = localStorage.getItem('newsHubAuth');
        if (authData) {
          try {
            const parsed = JSON.parse(authData);
            const now = Date.now();
            
            if (now - parsed.timestamp < this.sessionTimeout) {
              this.authenticated = true;
              this.showMainContent();
              return;
            } else {
              localStorage.removeItem('newsHubAuth');
            }
          } catch (error) {
            localStorage.removeItem('newsHubAuth');
          }
        }
        
        this.showAuthForm();
      }

      setupAuthUI() {
        // èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
        const authStyles = `
        <style>
          .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
          }
          
          .auth-form {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
          }
          
          .auth-title {
            margin-bottom: 1.5rem;
            color: #333;
            font-size: 1.5rem;
          }
          
          .auth-input {
            width: 100%;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
          }
          
          .auth-button {
            width: 100%;
            padding: 0.75rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 1rem;
          }
          
          .auth-button:hover {
            background: #5a6fd8;
          }
          
          .auth-error {
            color: #e74c3c;
            margin-top: 1rem;
            font-size: 0.9rem;
          }
          
          .main-content.hidden {
            display: none;
          }
        </style>
        `;
        
        document.head.insertAdjacentHTML('beforeend', authStyles);
      }

      showAuthForm() {
        const authHTML = `
        <div class="auth-overlay" id="authOverlay">
          <div class="auth-form">
            <div class="auth-title">
              ğŸ” News Hub Access
            </div>
            <input type="text" id="authUsername" class="auth-input" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" autocomplete="username">
            <input type="password" id="authPassword" class="auth-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" autocomplete="current-password">
            <button class="auth-button" onclick="authSystem.authenticate()">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div id="authError" class="auth-error"></div>
          </div>
        </div>
        `;
        
        document.body.insertAdjacentHTML('afterbegin', authHTML);
        
        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éš ã™
        const mainContent = document.querySelector('.header');
        if (mainContent) {
          mainContent.classList.add('hidden');
        }
        const mainContainer = document.querySelector('.main');
        if (mainContainer) {
          mainContainer.classList.add('hidden');
        }

        // Enter ã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
        document.getElementById('authPassword').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            this.authenticate();
          }
        });
        
        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®š
        setTimeout(() => {
          document.getElementById('authUsername').focus();
        }, 100);
      }

      authenticate() {
        const username = document.getElementById('authUsername').value;
        const password = document.getElementById('authPassword').value;
        const errorEl = document.getElementById('authError');
        
        if (username === this.credentials.username && password === this.credentials.password) {
          // èªè¨¼æˆåŠŸ
          this.authenticated = true;
          
          // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ä¿å­˜
          const authData = {
            timestamp: Date.now(),
            user: username
          };
          localStorage.setItem('newsHubAuth', JSON.stringify(authData));
          
          this.showMainContent();
        } else {
          // èªè¨¼å¤±æ•—
          errorEl.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™';
          
          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¬„ã‚’ã‚¯ãƒªã‚¢
          document.getElementById('authPassword').value = '';
          document.getElementById('authPassword').focus();
        }
      }

      showMainContent() {
        // èªè¨¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‰Šé™¤
        const overlay = document.getElementById('authOverlay');
        if (overlay) {
          overlay.remove();
        }
        
        // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
        const elements = document.querySelectorAll('.hidden');
        elements.forEach(el => el.classList.remove('hidden'));
        
        console.log('ğŸ” User authenticated successfully');
      }

      logout() {
        localStorage.removeItem('newsHubAuth');
        location.reload();
      }

      isAuthenticated() {
        return this.authenticated;
      }
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­å®š
    const authSystem = new BasicAuthSystem();
    window.authSystem = authSystem;
    
        </script>
        
        <script>
        
    // ğŸŒ¤ï¸ Weather Information System
    class WeatherSystem {
      constructor() {
        this.cache = null;
        this.cacheTimeout = 30 * 60 * 1000; // 30åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        this.location = 'Tokyo';
      }

      async getCurrentWeather() {
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯
        if (this.cache && (Date.now() - this.cache.timestamp < this.cacheTimeout)) {
          return this.cache.data;
        }

        console.log('ğŸŒ¤ï¸ Fetching weather data...');

        try {
          // wttr.inã‹ã‚‰å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
          const proxyUrl = 'https://api.allorigins.win/get';
          const weatherUrl = `https://wttr.in/${this.location}?format=j1`;
          const fullUrl = `${proxyUrl}?url=${encodeURIComponent(weatherUrl)}`;
          
          const response = await fetch(fullUrl);
          if (!response.ok) {
            throw new Error(`Weather API error: ${response.status}`);
          }
          
          const data = await response.json();
          const weatherData = JSON.parse(data.contents);
          
          const current = weatherData.current_condition[0];
          const forecast = weatherData.weather;
          
          const weatherInfo = {
            current: {
              temp: current.temp_C + 'Â°C',
              condition: this.getWeatherEmoji(current.weatherCode) + ' ' + current.weatherDesc[0].value,
              humidity: current.humidity + '%',
              windSpeed: current.windspeedKmph + 'km/h',
              windDir: current.winddir16Point,
              feelsLike: current.FeelsLikeC + 'Â°C'
            },
            forecast: forecast.slice(0, 3).map(day => ({
              date: new Date(day.date).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' }),
              maxTemp: day.maxtempC + 'Â°C',
              minTemp: day.mintempC + 'Â°C',
              condition: this.getWeatherEmoji(day.hourly[4].weatherCode) + ' ' + day.hourly[4].weatherDesc[0].value
            }))
          };
          
          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
          this.cache = {
            data: weatherInfo,
            timestamp: Date.now()
          };
          
          return weatherInfo;
        } catch (error) {
          console.error('Weather fetch error:', error);
          
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ ãƒ‡ãƒ¼ã‚¿
          return {
            current: {
              temp: '--Â°C',
              condition: 'ğŸŒ¤ï¸ æƒ…å ±å–å¾—ä¸­...',
              humidity: '--%',
              windSpeed: '--km/h',
              windDir: '--',
              feelsLike: '--Â°C'
            },
            forecast: []
          };
        }
      }

      getWeatherEmoji(weatherCode) {
        const code = parseInt(weatherCode);
        
        if (code === 113) return 'â˜€ï¸'; // Sunny
        if (code === 116) return 'ğŸŒ¤ï¸'; // Partly cloudy
        if (code === 119 || code === 122) return 'â˜ï¸'; // Cloudy
        if (code === 143 || code === 248) return 'ğŸŒ«ï¸'; // Fog
        if (code >= 176 && code <= 200) return 'ğŸŒ§ï¸'; // Rain
        if (code >= 227 && code <= 230) return 'ğŸŒ¨ï¸'; // Snow
        if (code >= 200 && code <= 230) return 'â›ˆï¸'; // Thunder
        if (code >= 260 && code <= 284) return 'ğŸŒ§ï¸'; // Light rain
        if (code >= 293 && code <= 299) return 'ğŸŒ¦ï¸'; // Light rain shower
        if (code >= 302 && code <= 359) return 'ğŸŒ§ï¸'; // Heavy rain
        if (code >= 362 && code <= 374) return 'ğŸŒ¨ï¸'; // Snow
        if (code >= 377 && code <= 395) return 'â„ï¸'; // Heavy snow
        
        return 'ğŸŒ¤ï¸'; // Default
      }

      renderWeatherWidget(weatherData) {
        const current = weatherData.current;
        const forecast = weatherData.forecast;
        
        return `
        <div class="weather-widget">
          <div class="weather-header">
            <h3>ğŸŒ¤ï¸ æ±äº¬ã®å¤©æ°—</h3>
            <small>æœ€çµ‚æ›´æ–°: ${new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}</small>
          </div>
          
          <div class="weather-current">
            <div class="weather-main">
              <span class="weather-temp">${current.temp}</span>
              <span class="weather-condition">${current.condition}</span>
            </div>
            <div class="weather-details">
              <div>ğŸ’§ æ¹¿åº¦: ${current.humidity}</div>
              <div>ğŸ’¨ é¢¨é€Ÿ: ${current.windSpeed} ${current.windDir}</div>
              <div>ğŸŒ¡ï¸ ä½“æ„Ÿ: ${current.feelsLike}</div>
            </div>
          </div>
          
          ${forecast.length > 0 ? `
          <div class="weather-forecast">
            <h4>ğŸ“… 3æ—¥é–“äºˆå ±</h4>
            <div class="forecast-list">
              ${forecast.map(day => `
                <div class="forecast-item">
                  <div class="forecast-date">${day.date}</div>
                  <div class="forecast-condition">${day.condition}</div>
                  <div class="forecast-temp">${day.maxTemp}/${day.minTemp}</div>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
        </div>
        `;
      }
    }

    // å¤©æ°—ã‚·ã‚¹ãƒ†ãƒ ã‚’News Hubã«çµ±åˆ
    if (typeof window !== 'undefined') {
      window.weatherSystem = new WeatherSystem();
    }
    
        </script>
        
        <script>
        
    // ğŸ“ˆ Weight Chart Integration System  
    class WeightChartSystem {
      constructor() {
        this.chartImageUrl = 'https://i.imgur.com/ZCaqkoK.png'; // æ—¢å­˜ã®imgur URL
      }

      renderWeightWidget() {
        return `
        <div class="weight-widget">
          <div class="weight-header">
            <h3>ğŸ“ˆ ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
            <small>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: Withings</small>
          </div>
          
          <div class="weight-chart">
            <img src="${this.chartImageUrl}" 
                 alt="ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•" 
                 class="weight-chart-img"
                 onclick="this.classList.toggle('enlarged')"
                 title="ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§">
          </div>
          
          <div class="weight-info">
            <div class="weight-note">
              ğŸ’¡ ã‚°ãƒ©ãƒ•ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ‹¡å¤§è¡¨ç¤ºã•ã‚Œã¾ã™<br>
              ğŸ“Š æ¯é€±é‡‘æ›œæ—¥9æ™‚ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™
            </div>
          </div>
        </div>
        `;
      }
    }

    // ä½“é‡ãƒãƒ£ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’News Hubã«çµ±åˆ
    if (typeof window !== 'undefined') {
      window.weightChartSystem = new WeightChartSystem();
    }
    
        </script>
        
        <script>
        
    // ğŸ“Š Enhanced News Hub with Dashboard
    class EnhancedNewsHub extends NewsHub {
      constructor() {
        super();
        this.updateInterval = 30 * 60 * 1000; // 30åˆ†ã«å¤‰æ›´
        this.setupDashboard();
      }

      async setupDashboard() {
        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        if (!window.authSystem || !window.authSystem.isAuthenticated()) {
          return;
        }

        console.log('ğŸ“Š Setting up enhanced dashboard...');
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ 
        const main = document.querySelector('.main');
        if (main) {
          const dashboardHTML = `
          <section class="dashboard-widgets" id="dashboardWidgets">
            <!-- å¤©æ°—äºˆå ±ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ -->
            <div id="weatherWidget">
              <div class="loading">
                <div class="spinner"></div>
                <p>å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
              </div>
            </div>
            
            <!-- ä½“é‡ãƒãƒ£ãƒ¼ãƒˆã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ -->
            <div id="weightWidget">
              ${window.weightChartSystem ? window.weightChartSystem.renderWeightWidget() : ''}
            </div>
          </section>
          `;
          
          main.insertAdjacentHTML('afterbegin', dashboardHTML);
        }

        // ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’åˆæœŸåŒ–
        await this.loadDashboardData();
      }

      async loadDashboardData() {
        // å¤©æ°—äºˆå ±ã‚’èª­ã¿è¾¼ã¿
        if (window.weatherSystem) {
          try {
            const weatherData = await window.weatherSystem.getCurrentWeather();
            const weatherWidget = document.getElementById('weatherWidget');
            if (weatherWidget) {
              weatherWidget.innerHTML = window.weatherSystem.renderWeatherWidget(weatherData);
            }
          } catch (error) {
            console.error('Weather loading error:', error);
          }
        }

        // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚‚ä¸¦è¡Œã—ã¦èª­ã¿è¾¼ã¿
        this.loadNews();
      }

      // ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰: è‡ªå‹•æ›´æ–°é–“éš”ã‚’30åˆ†ã«å¤‰æ›´
      init() {
        super.init();
        
        // æ—¢å­˜ã®5åˆ†é–“éš”ã‚’åœæ­¢ã—ã¦30åˆ†é–“éš”ã«å¤‰æ›´
        clearInterval(this.autoRefreshTimer);
        
        this.autoRefreshTimer = setInterval(() => {
          console.log('â° Auto-refreshing news and dashboard (30 min interval)...');
          this.loadDashboardData();
        }, this.updateInterval);
      }

      // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ‰‹å‹•æ›´æ–°
      async refreshDashboard() {
        console.log('ğŸ”„ Manually refreshing dashboard...');
        this.showStatusMessage('ğŸ”„ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ›´æ–°ä¸­...', 'info');
        
        await this.loadDashboardData();
        
        this.showStatusMessage('âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ', 'success');
      }
    }

    // èªè¨¼å¾Œã«Enhanced News Hubã‚’åˆæœŸåŒ–
    const originalShowMainContent = window.authSystem.showMainContent;
    window.authSystem.showMainContent = function() {
      originalShowMainContent.call(this);
      
      // èªè¨¼æˆåŠŸå¾Œã«Enhanced News Hubã‚’åˆæœŸåŒ–
      setTimeout(() => {
        if (window.newsHub) {
          // æ—¢å­˜ã®newsHubã‚’EnhancedNewsHubã§ç½®ãæ›ãˆ
          window.newsHub = new EnhancedNewsHub();
          console.log('ğŸš€ Enhanced News Hub initialized');
        }
      }, 1000);
    };

    // æ‰‹å‹•æ›´æ–°ãƒœã‚¿ãƒ³ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ 
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        const controls = document.querySelector('.controls');
        if (controls && window.authSystem && window.authSystem.isAuthenticated()) {
          const refreshBtn = document.createElement('button');
          refreshBtn.className = 'theme-toggle';
          refreshBtn.innerHTML = 'ğŸ”„';
          refreshBtn.title = 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°';
          refreshBtn.onclick = () => {
            if (window.newsHub && window.newsHub.refreshDashboard) {
              window.newsHub.refreshDashboard();
            }
          };
          
          const logoutBtn = document.createElement('button');
          logoutBtn.className = 'theme-toggle';
          logoutBtn.innerHTML = 'ğŸšª';
          logoutBtn.title = 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ';
          logoutBtn.style.marginLeft = '0.5rem';
          logoutBtn.onclick = () => window.authSystem.logout();
          
          controls.appendChild(refreshBtn);
          controls.appendChild(logoutBtn);
        }
      }, 2000);
    });

    console.log('ğŸ›ï¸ Enhanced News Hub system loaded');
    
        </script>
        
        <!-- ğŸ”§ Fixed News Integration System -->
        <script>
        
    // ğŸ”§ Fixed News Integration System
    class FixedNewsSystem {
      constructor() {
        this.newsApiKey = '37bec8593888416299df95ed455407f8';
        this.proxyUrl = 'https://cors-anywhere.herokuapp.com/'; // ã‚ˆã‚Šä¿¡é ¼æ€§ã®é«˜ã„ãƒ—ãƒ­ã‚­ã‚·
        this.fallbackProxy = 'https://api.allorigins.win/get';
        this.cache = new Map();
        this.cacheTimeout = 30 * 60 * 1000; // 30åˆ†
        this.newsData = [];
      }

      async fetchWithMultipleProxies(url) {
        const proxies = [
          // Direct (CORSè¨±å¯ã‚µã‚¤ãƒˆã®å ´åˆ)
          { url: url, type: 'direct' },
          // AllOrigins proxy
          { 
            url: `${this.fallbackProxy}?url=${encodeURIComponent(url)}`,
            type: 'allorigins'
          }
        ];

        for (let proxy of proxies) {
          try {
            console.log(`ğŸŒ Trying ${proxy.type} for: ${url.substring(0, 50)}...`);
            
            const response = await fetch(proxy.url);
            if (!response.ok) {
              throw new Error(`HTTP error: ${response.status}`);
            }

            const data = await response.text();
            
            if (proxy.type === 'allorigins') {
              const parsed = JSON.parse(data);
              return parsed.contents;
            } else {
              return data;
            }
          } catch (error) {
            console.warn(`âŒ ${proxy.type} failed:`, error.message);
            continue;
          }
        }

        throw new Error('All proxy methods failed');
      }

      async getNewsAPIData() {
        const categories = ['general', 'business', 'technology'];
        const allArticles = [];

        console.log('ğŸ“° Loading NewsAPI data...');

        for (let category of categories) {
          try {
            const cacheKey = `newsapi-${category}`;
            const cached = this.cache.get(cacheKey);
            
            if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
              allArticles.push(...cached.articles);
              continue;
            }

            const url = `https://newsapi.org/v2/top-headlines?country=jp&category=${category}&pageSize=5&apiKey=${this.newsApiKey}`;
            
            const responseText = await this.fetchWithMultipleProxies(url);
            const data = JSON.parse(responseText);
            
            if (data.status === 'ok' && data.articles) {
              const articles = data.articles
                .filter(article => article.title && !article.title.includes('[Removed]'))
                .map(article => ({
                  title: article.title,
                  summary: (article.description || article.title).substring(0, 120) + '...',
                  category: category,
                  source: article.source.name,
                  time: this.formatTime(article.publishedAt),
                  url: article.url,
                  image: article.urlToImage
                }));

              allArticles.push(...articles);
              
              // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
              this.cache.set(cacheKey, {
                articles: articles,
                timestamp: Date.now()
              });
              
              console.log(`âœ… NewsAPI ${category}: ${articles.length} articles`);
            }
          } catch (error) {
            console.error(`âŒ NewsAPI ${category} error:`, error);
          }
        }

        return allArticles;
      }

      async getJapaneseNewsData() {
        const sources = [
          {
            name: 'Yahoo!ãƒ‹ãƒ¥ãƒ¼ã‚¹',
            url: 'https://news.yahoo.co.jp',
            category: 'general'
          },
          {
            name: 'ITmedia',
            url: 'https://www.itmedia.co.jp',
            category: 'technology'
          }
        ];

        const articles = [];
        console.log('ğŸ—¾ Loading Japanese news...');

        for (let source of sources) {
          try {
            const cacheKey = `jp-${source.name}`;
            const cached = this.cache.get(cacheKey);
            
            if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
              articles.push(...cached.articles);
              continue;
            }

            const htmlContent = await this.fetchWithMultipleProxies(source.url);
            const parsed = this.parseJapaneseNews(htmlContent, source);
            
            articles.push(...parsed);
            
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
            this.cache.set(cacheKey, {
              articles: parsed,
              timestamp: Date.now()
            });
            
            console.log(`âœ… ${source.name}: ${parsed.length} articles`);
          } catch (error) {
            console.error(`âŒ ${source.name} error:`, error);
          }
        }

        return articles;
      }

      parseJapaneseNews(html, source) {
        try {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const articles = [];

          // Yahoo!ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”¨ã®ã‚»ãƒ¬ã‚¯ã‚¿
          if (source.name === 'Yahoo!ãƒ‹ãƒ¥ãƒ¼ã‚¹') {
            const items = doc.querySelectorAll('.newsFeed_item, .sc-fjpCk, .sc-gKTREg');
            
            items.forEach((item, index) => {
              if (index >= 5) return; // æœ€å¤§5ä»¶
              
              const titleEl = item.querySelector('.newsFeed_item_title, a');
              if (titleEl) {
                const title = titleEl.textContent.trim();
                if (title && title.length > 5) {
                  articles.push({
                    title: title,
                    summary: title.substring(0, 80) + '...',
                    category: source.category,
                    source: source.name,
                    time: this.formatTime(new Date().toISOString()),
                    url: source.url,
                    image: null
                  });
                }
              }
            });
          }
          
          // ITmediaç”¨ã®ã‚»ãƒ¬ã‚¯ã‚¿
          else if (source.name === 'ITmedia') {
            const items = doc.querySelectorAll('.colBoxBody li, .gmenu_list li');
            
            items.forEach((item, index) => {
              if (index >= 5) return;
              
              const linkEl = item.querySelector('a');
              if (linkEl) {
                const title = linkEl.textContent.trim();
                if (title && title.length > 5) {
                  articles.push({
                    title: title,
                    summary: title.substring(0, 80) + '...',
                    category: source.category,
                    source: source.name,
                    time: this.formatTime(new Date().toISOString()),
                    url: source.url,
                    image: null
                  });
                }
              }
            });
          }

          return articles;
        } catch (error) {
          console.error('Parse error:', error);
          return [];
        }
      }

      formatTime(isoString) {
        try {
          const date = new Date(isoString);
          const now = new Date();
          const diffMs = now - date;
          const diffMins = Math.floor(diffMs / 60000);
          const diffHours = Math.floor(diffMs / 3600000);

          if (diffMins < 60) {
            return `${Math.max(1, diffMins)}åˆ†å‰`;
          } else if (diffHours < 24) {
            return `${diffHours}æ™‚é–“å‰`;
          } else {
            return date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
          }
        } catch (error) {
          return 'æœ€è¿‘';
        }
      }

      async loadAllNews() {
        try {
          console.log('ğŸš€ Loading all news sources...');
          
          // ä¸¦è¡Œã—ã¦NewsAPIã¨æ—¥æœ¬èªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—
          const [newsApiArticles, japaneseArticles] = await Promise.all([
            this.getNewsAPIData(),
            this.getJapaneseNewsData()
          ]);

          // é™çš„ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚‚è¿½åŠ ï¼ˆç¢ºå®Ÿã«ä½•ã‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰
          const placeholderNews = [
            {
              title: 'ğŸ“° News Hub ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸å‹•ä½œä¸­',
              summary: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¡¨ç¤ºä¸­ã§ã™ã€‚',
              category: 'general',
              source: 'News Hub System',
              time: 'ç¨¼åƒä¸­',
              url: '#',
              image: null
            }
          ];

          // å…¨ã¦ã®è¨˜äº‹ã‚’ãƒãƒ¼ã‚¸
          const allArticles = [
            ...placeholderNews,
            ...newsApiArticles,
            ...japaneseArticles
          ];

          // é‡è¤‡é™¤å»
          const uniqueArticles = this.removeDuplicates(allArticles);
          
          console.log(`âœ… Total articles loaded: ${uniqueArticles.length}`);
          console.log(`  - NewsAPI: ${newsApiArticles.length}`);
          console.log(`  - Japanese: ${japaneseArticles.length}`);
          console.log(`  - Placeholder: ${placeholderNews.length}`);

          this.newsData = uniqueArticles;
          return uniqueArticles;
        } catch (error) {
          console.error('âŒ Critical error loading news:', error);
          
          // ç·Šæ€¥æ™‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
          return [{
            title: 'âš ï¸ ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
            summary: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚½ãƒ¼ã‚¹ã¨ã®æ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã—ã°ã‚‰ãå¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
            category: 'error',
            source: 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼',
            time: 'ç¾åœ¨',
            url: '#',
            image: null
          }];
        }
      }

      removeDuplicates(articles) {
        const seen = new Set();
        return articles.filter(article => {
          const key = article.title.toLowerCase().replace(/[^a-z0-9]/g, '');
          if (seen.has(key)) {
            return false;
          }
          seen.add(key);
          return true;
        });
      }
    }

    // å¤©æ°—ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç°¡ç•¥ç‰ˆï¼‰
    class SimpleWeatherSystem {
      constructor() {
        this.cache = null;
        this.cacheTimeout = 30 * 60 * 1000;
      }

      async getCurrentWeather() {
        if (this.cache && (Date.now() - this.cache.timestamp < this.cacheTimeout)) {
          return this.cache.data;
        }

        try {
          console.log('ğŸŒ¤ï¸ Loading weather...');
          
          // Open-Meteo API (ã‚ˆã‚Šä¿¡é ¼æ€§ãŒé«˜ã„)
          const lat = 35.6762; // æ±äº¬
          const lon = 139.6503;
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Asia/Tokyo`;
          
          const response = await fetch(url);
          const data = await response.json();
          
          if (data.current_weather) {
            const weatherInfo = {
              current: {
                temp: Math.round(data.current_weather.temperature) + 'Â°C',
                condition: this.getWeatherIcon(data.current_weather.weathercode) + ' ' + this.getWeatherDescription(data.current_weather.weathercode),
                windSpeed: Math.round(data.current_weather.windspeed) + 'km/h'
              },
              forecast: data.daily ? data.daily.time.slice(1, 4).map((date, index) => ({
                date: new Date(date).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' }),
                maxTemp: Math.round(data.daily.temperature_2m_max[index + 1]) + 'Â°C',
                minTemp: Math.round(data.daily.temperature_2m_min[index + 1]) + 'Â°C',
                condition: this.getWeatherIcon(data.daily.weathercode[index + 1])
              })) : []
            };
            
            this.cache = { data: weatherInfo, timestamp: Date.now() };
            return weatherInfo;
          }
        } catch (error) {
          console.error('Weather error:', error);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        return {
          current: {
            temp: '--Â°C',
            condition: 'ğŸŒ¤ï¸ æ±äº¬',
            windSpeed: '--km/h'
          },
          forecast: []
        };
      }

      getWeatherIcon(code) {
        if (code === 0) return 'â˜€ï¸';
        if (code <= 3) return 'ğŸŒ¤ï¸';
        if (code <= 48) return 'â˜ï¸';
        if (code <= 67) return 'ğŸŒ§ï¸';
        if (code <= 86) return 'ğŸŒ¨ï¸';
        return 'ğŸŒ¤ï¸';
      }

      getWeatherDescription(code) {
        if (code === 0) return 'æ™´ã‚Œ';
        if (code <= 3) return 'æ™´ã‚Œæ™‚ã€…æ›‡ã‚Š';
        if (code <= 48) return 'æ›‡ã‚Š';
        if (code <= 67) return 'é›¨';
        if (code <= 86) return 'é›ª';
        return 'æ™´ã‚Œ';
      }

      renderWeatherWidget(data) {
        return `
        <div class="weather-widget">
          <div class="weather-header">
            <h3>ğŸŒ¤ï¸ æ±äº¬ã®å¤©æ°—</h3>
            <small>æœ€çµ‚æ›´æ–°: ${new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}</small>
          </div>
          <div class="weather-current">
            <div class="weather-main">
              <span class="weather-temp">${data.current.temp}</span>
              <span class="weather-condition">${data.current.condition}</span>
              <small>é¢¨é€Ÿ: ${data.current.windSpeed}</small>
            </div>
          </div>
          ${data.forecast.length > 0 ? `
          <div class="weather-forecast">
            <h4>ğŸ“… 3æ—¥é–“äºˆå ±</h4>
            <div class="forecast-list">
              ${data.forecast.map(day => `
                <div class="forecast-item">
                  <div class="forecast-date">${day.date}</div>
                  <div class="forecast-condition">${day.condition}</div>
                  <div class="forecast-temp">${day.maxTemp}/${day.minTemp}</div>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
        </div>
        `;
      }
    }

    // ãƒ¡ã‚¤ãƒ³çµ±åˆã‚·ã‚¹ãƒ†ãƒ 
    class IntegratedNewsHub {
      constructor() {
        this.newsSystem = new FixedNewsSystem();
        this.weatherSystem = new SimpleWeatherSystem();
        this.newsData = [];
        this.currentCategory = 'all';
        this.init();
      }

      async init() {
        console.log('ğŸš€ Initializing Integrated News Hub...');
        
        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        if (!this.checkAuth()) {
          return;
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        await this.setupDashboard();
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        this.setupEventListeners();
        
        // 30åˆ†é–“éš”ã®è‡ªå‹•æ›´æ–°
        setInterval(() => {
          console.log('â° Auto refresh...');
          this.refreshDashboard();
        }, 30 * 60 * 1000);
        
        console.log('âœ… Integrated News Hub ready');
      }

      checkAuth() {
        // ç°¡æ˜“èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆBasicèªè¨¼ã¯åˆ¥ã§å‡¦ç†ï¼‰
        return true;
      }

      async setupDashboard() {
        const main = document.querySelector('.main');
        if (!main) return;

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰HTMLæŒ¿å…¥
        const dashboardHTML = `
        <section class="dashboard-widgets">
          <div id="weatherWidget">
            <div class="loading"><div class="spinner"></div><p>å¤©æ°—æƒ…å ±èª­ã¿è¾¼ã¿ä¸­...</p></div>
          </div>
          <div id="weightWidget">
            <div class="weight-widget">
              <div class="weight-header">
                <h3>ğŸ“ˆ ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
              </div>
              <div class="weight-chart">
                <img src="https://i.imgur.com/ZCaqkoK.png" alt="ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•" class="weight-chart-img" onclick="this.classList.toggle('enlarged')">
              </div>
            </div>
          </div>
        </section>
        `;
        
        main.insertAdjacentHTML('afterbegin', dashboardHTML);

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹
        await this.refreshDashboard();
      }

      async refreshDashboard() {
        try {
          // å¤©æ°—ã¨ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ä¸¦è¡Œèª­ã¿è¾¼ã¿
          const [weatherData, newsData] = await Promise.all([
            this.weatherSystem.getCurrentWeather(),
            this.newsSystem.loadAllNews()
          ]);

          // å¤©æ°—ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ›´æ–°
          const weatherWidget = document.getElementById('weatherWidget');
          if (weatherWidget) {
            weatherWidget.innerHTML = this.weatherSystem.renderWeatherWidget(weatherData);
          }

          // ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°
          this.newsData = newsData;
          this.renderNews();
          
          this.showMessage(`ğŸ“° ${newsData.length}ä»¶ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨å¤©æ°—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ`, 'success');
        } catch (error) {
          console.error('Dashboard refresh error:', error);
          this.showMessage('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
      }

      renderNews() {
        const grid = document.getElementById('newsGrid');
        if (!grid) return;

        const filtered = this.newsData.filter(news => {
          return this.currentCategory === 'all' || news.category === this.currentCategory;
        });

        if (filtered.length === 0) {
          grid.innerHTML = '<div class="status-message">ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>';
          return;
        }

        grid.innerHTML = filtered.map(news => `
        <article class="news-card">
          ${news.image ? 
            `<img src="${news.image}" alt="${news.title}" class="news-image" onerror="this.style.display='none'">` :
            `<div class="news-image">ğŸ“°</div>`
          }
          <div class="news-content">
            <span class="news-category">${this.getCategoryLabel(news.category)}</span>
            <h2 class="news-title">
              <a href="${news.url}" target="_blank" rel="noopener noreferrer">${news.title}</a>
            </h2>
            <p class="news-summary">${news.summary}</p>
            <div class="news-meta">
              <span class="news-source">${news.source}</span>
              <time class="news-time">${news.time}</time>
            </div>
          </div>
        </article>
        `).join('');
      }

      setupEventListeners() {
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
        document.querySelectorAll('.nav-item').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            this.selectCategory(e.target.dataset.category);
          });
        });
      }

      selectCategory(category) {
        this.currentCategory = category;
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.toggle('active', item.dataset.category === category);
        });
        this.renderNews();
      }

      getCategoryLabel(category) {
        const labels = {
          'general': 'ä¸€èˆ¬',
          'business': 'ãƒ“ã‚¸ãƒã‚¹',
          'technology': 'ãƒ†ãƒƒã‚¯',
          'sports': 'ã‚¹ãƒãƒ¼ãƒ„',
          'error': 'ã‚·ã‚¹ãƒ†ãƒ '
        };
        return labels[category] || category;
      }

      showMessage(message, type = 'info') {
        const statusDiv = document.getElementById('statusMessage') || this.createStatusDiv();
        statusDiv.textContent = message;
        statusDiv.className = `status-message ${type}-message`;
        statusDiv.style.display = 'block';
        setTimeout(() => statusDiv.style.display = 'none', 5000);
      }

      createStatusDiv() {
        const div = document.createElement('div');
        div.id = 'statusMessage';
        div.className = 'status-message';
        div.style.display = 'none';
        document.querySelector('.main').appendChild(div);
        return div;
      }
    }

    // èªè¨¼å¾Œã«è‡ªå‹•åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // å°‘ã—é…å»¶ã•ã›ã¦åˆæœŸåŒ–
      setTimeout(() => {
        window.integratedNewsHub = new IntegratedNewsHub();
        console.log('ğŸ›ï¸ Integrated News Hub started');
      }, 2000);
    });

    console.log('ğŸ”§ Fixed news integration system loaded');
    
        </script>
        
        <!-- ğŸŒ Guardian & Reddit API Integration -->
        <script>
        
    // ğŸŒ Guardian & Reddit API Integration
    class GuardianRedditNewsSystem {
      constructor() {
        this.guardianBaseUrl = 'https://content.guardianapis.com/search';
        this.guardianApiKey = 'test'; // ç„¡æ–™ãƒ†ã‚¹ãƒˆã‚­ãƒ¼
        this.redditBaseUrl = 'https://www.reddit.com/r';
        this.cache = new Map();
        this.cacheTimeout = 30 * 60 * 1000; // 30åˆ†
      }

      async fetchWithProxy(url) {
        const proxies = [
          { url: url, type: 'direct' },
          { 
            url: `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
            type: 'allorigins'
          }
        ];

        for (let proxy of proxies) {
          try {
            const response = await fetch(proxy.url);
            if (!response.ok) throw new Error(`HTTP error: ${response.status}`);

            const data = await response.text();
            
            if (proxy.type === 'allorigins') {
              const parsed = JSON.parse(data);
              return parsed.contents;
            } else {
              return data;
            }
          } catch (error) {
            console.warn(`${proxy.type} failed:`, error.message);
            continue;
          }
        }

        throw new Error('All proxy methods failed for: ' + url);
      }

      async getGuardianNews() {
        const cacheKey = 'guardian-news';
        const cached = this.cache.get(cacheKey);
        
        if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
          return cached.articles;
        }

        console.log('ğŸ›ï¸ Fetching Guardian news...');

        try {
          const sections = ['world', 'business', 'technology', 'politics'];
          const allArticles = [];

          for (let section of sections) {
            try {
              const url = new URL(this.guardianBaseUrl);
              url.searchParams.set('api-key', this.guardianApiKey);
              url.searchParams.set('section', section);
              url.searchParams.set('show-fields', 'headline,thumbnail,short-url,body-text');
              url.searchParams.set('page-size', '5');
              url.searchParams.set('order-by', 'newest');

              const responseText = await this.fetchWithProxy(url.toString());
              const data = JSON.parse(responseText);

              if (data.response && data.response.results) {
                const articles = data.response.results.map(article => ({
                  title: this.cleanTitle(article.webTitle),
                  summary: this.generateSummary(article.fields?.bodyText || article.webTitle),
                  category: this.mapGuardianSection(section),
                  source: 'The Guardian',
                  time: this.formatTime(article.webPublicationDate),
                  url: article.webUrl,
                  image: article.fields?.thumbnail || null
                }));

                allArticles.push(...articles);
                console.log(`âœ… Guardian ${section}: ${articles.length} articles`);
              }
            } catch (sectionError) {
              console.error(`Guardian ${section} error:`, sectionError);
            }
          }

          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
          this.cache.set(cacheKey, {
            articles: allArticles,
            timestamp: Date.now()
          });

          return allArticles;
        } catch (error) {
          console.error('Guardian API error:', error);
          return [];
        }
      }

      async getRedditNews() {
        const cacheKey = 'reddit-news';
        const cached = this.cache.get(cacheKey);
        
        if (cached && (Date.now() - cached.timestamp < this.cacheTimeout)) {
          return cached.articles;
        }

        console.log('ğŸ’¬ Fetching Reddit news...');

        try {
          const subreddits = [
            { name: 'technology', category: 'technology' },
            { name: 'programming', category: 'technology' },
            { name: 'worldnews', category: 'world' },
            { name: 'business', category: 'business' }
          ];
          
          const allArticles = [];

          for (let subreddit of subreddits) {
            try {
              const url = `${this.redditBaseUrl}/${subreddit.name}/hot.json?limit=5`;
              
              const responseText = await this.fetchWithProxy(url);
              const data = JSON.parse(responseText);

              if (data.data && data.data.children) {
                const articles = data.data.children
                  .filter(post => {
                    const postData = post.data;
                    return !postData.stickied && 
                           !postData.is_self && 
                           postData.title &&
                           !postData.title.toLowerCase().includes('megathread') &&
                           postData.score > 50; // 50ä»¥ä¸Šã®ã‚¹ã‚³ã‚¢ã®ã¿
                  })
                  .map(post => {
                    const postData = post.data;
                    return {
                      title: this.cleanTitle(postData.title),
                      summary: this.generateRedditSummary(postData),
                      category: subreddit.category,
                      source: `Reddit r/${subreddit.name}`,
                      time: this.formatTime(new Date(postData.created_utc * 1000).toISOString()),
                      url: `https://reddit.com${postData.permalink}`,
                      image: this.getRedditImage(postData),
                      score: postData.score,
                      comments: postData.num_comments
                    };
                  });

                allArticles.push(...articles);
                console.log(`âœ… Reddit r/${subreddit.name}: ${articles.length} articles`);
              }
            } catch (subredditError) {
              console.error(`Reddit r/${subreddit.name} error:`, subredditError);
            }
          }

          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
          this.cache.set(cacheKey, {
            articles: allArticles,
            timestamp: Date.now()
          });

          return allArticles;
        } catch (error) {
          console.error('Reddit API error:', error);
          return [];
        }
      }

      cleanTitle(title) {
        if (!title) return 'ã‚¿ã‚¤ãƒˆãƒ«ä¸æ˜';
        return title.replace(/\s+/g, ' ')
                   .replace(/[\r\n]+/g, '')
                   .trim()
                   .substring(0, 120);
      }

      generateSummary(bodyText) {
        if (!bodyText) return '';
        
        // HTMLã‚¿ã‚°ã‚’é™¤å»ã—ã€æœ€åˆã®120æ–‡å­—ã‚’å–å¾—
        const cleanText = bodyText.replace(/<[^>]*>/g, '')
                                  .replace(/\s+/g, ' ')
                                  .trim();
        
        return cleanText.length > 120 ? 
               cleanText.substring(0, 120) + '...' : 
               cleanText;
      }

      generateRedditSummary(postData) {
        const parts = [];
        
        if (postData.score) {
          parts.push(`ğŸ‘ ${postData.score}`);
        }
        
        if (postData.num_comments) {
          parts.push(`ğŸ’¬ ${postData.num_comments}`);
        }
        
        if (postData.selftext && postData.selftext.length > 0) {
          const text = postData.selftext.substring(0, 80);
          parts.push(text + (postData.selftext.length > 80 ? '...' : ''));
        } else if (postData.url && !postData.url.includes('reddit.com')) {
          parts.push(`ğŸ”— å¤–éƒ¨ãƒªãƒ³ã‚¯: ${new URL(postData.url).hostname}`);
        }

        return parts.join(' â€¢ ') || 'RedditæŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„';
      }

      getRedditImage(postData) {
        if (postData.preview && postData.preview.images && postData.preview.images[0]) {
          return postData.preview.images[0].source.url.replace(/&amp;/g, '&');
        }
        
        if (postData.thumbnail && 
            postData.thumbnail !== 'self' && 
            postData.thumbnail !== 'default' && 
            postData.thumbnail.startsWith('http')) {
          return postData.thumbnail;
        }
        
        return null;
      }

      mapGuardianSection(section) {
        const mapping = {
          'world': 'world',
          'business': 'business', 
          'technology': 'technology',
          'politics': 'world'
        };
        return mapping[section] || 'general';
      }

      formatTime(isoString) {
        try {
          const date = new Date(isoString);
          const now = new Date();
          const diffMs = now - date;
          const diffMins = Math.floor(diffMs / 60000);
          const diffHours = Math.floor(diffMs / 3600000);
          const diffDays = Math.floor(diffMs / 86400000);

          if (diffMins < 60) {
            return `${Math.max(1, diffMins)}åˆ†å‰`;
          } else if (diffHours < 24) {
            return `${diffHours}æ™‚é–“å‰`;
          } else if (diffDays < 7) {
            return `${diffDays}æ—¥å‰`;
          } else {
            return date.toLocaleDateString('ja-JP', {
              month: 'short',
              day: 'numeric'
            });
          }
        } catch (error) {
          return 'æœ€è¿‘';
        }
      }

      async loadAllGuardianRedditNews() {
        try {
          console.log('ğŸŒ Loading Guardian & Reddit news...');
          
          const [guardianArticles, redditArticles] = await Promise.all([
            this.getGuardianNews(),
            this.getRedditNews()
          ]);

          const allArticles = [...guardianArticles, ...redditArticles];
          
          console.log(`âœ… Guardian & Reddit loaded: ${allArticles.length} articles`);
          console.log(`  - Guardian: ${guardianArticles.length}`);
          console.log(`  - Reddit: ${redditArticles.length}`);
          
          return allArticles;
        } catch (error) {
          console.error('Guardian & Reddit loading error:', error);
          return [];
        }
      }
    }

    // æ—¢å­˜ã®NewsSystemã«çµ±åˆ
    if (typeof window !== 'undefined' && window.integratedNewsHub) {
      const newsHub = window.integratedNewsHub;
      
      // Guardian & Reddit ã‚·ã‚¹ãƒ†ãƒ ã‚’è¿½åŠ 
      newsHub.guardianRedditSystem = new GuardianRedditNewsSystem();
      
      // æ—¢å­˜ã®refreshDashboard methodã‚’æ‹¡å¼µ
      const originalRefreshDashboard = newsHub.refreshDashboard;
      
      newsHub.refreshDashboard = async function() {
        try {
          console.log('ğŸ”„ Enhanced dashboard refresh with Guardian & Reddit...');
          
          // å¤©æ°—ã€æ—¢å­˜ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€Guardian & Reddit ã‚’ä¸¦è¡Œå–å¾—
          const [weatherData, existingNewsData, guardianRedditData] = await Promise.all([
            this.weatherSystem.getCurrentWeather(),
            this.newsSystem.loadAllNews(),
            this.guardianRedditSystem.loadAllGuardianRedditNews()
          ]);

          // å¤©æ°—ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ›´æ–°
          const weatherWidget = document.getElementById('weatherWidget');
          if (weatherWidget) {
            weatherWidget.innerHTML = this.weatherSystem.renderWeatherWidget(weatherData);
          }

          // å…¨ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ãƒãƒ¼ã‚¸
          const allNewsData = [...existingNewsData, ...guardianRedditData];
          
          // é‡è¤‡é™¤å»
          this.newsData = this.removeDuplicatesByTitle(allNewsData);
          this.renderNews();
          
          this.showMessage(
            `ğŸ“° ${this.newsData.length}ä»¶ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾—å®Œäº† (Guardian: ${guardianRedditData.filter(a => a.source.includes('Guardian')).length}ä»¶, Reddit: ${guardianRedditData.filter(a => a.source.includes('Reddit')).length}ä»¶å«ã‚€)`, 
            'success'
          );
        } catch (error) {
          console.error('Enhanced dashboard refresh error:', error);
          this.showMessage('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
      };
      
      // ã‚«ãƒ†ã‚´ãƒªãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
      const originalGetCategoryLabel = newsHub.getCategoryLabel;
      newsHub.getCategoryLabel = function(category) {
        const labels = {
          'general': 'ä¸€èˆ¬',
          'business': 'ãƒ“ã‚¸ãƒã‚¹',
          'technology': 'ãƒ†ãƒƒã‚¯',
          'sports': 'ã‚¹ãƒãƒ¼ãƒ„',
          'world': 'å›½éš›',
          'error': 'ã‚·ã‚¹ãƒ†ãƒ '
        };
        return labels[category] || category;
      };

      // é‡è¤‡é™¤å»ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ï¼ˆæ—¢ã«ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒå¿µã®ãŸã‚ï¼‰
      if (!newsHub.removeDuplicatesByTitle) {
        newsHub.removeDuplicatesByTitle = function(articles) {
          const seen = new Set();
          return articles.filter(article => {
            const key = article.title.toLowerCase()
                                   .replace(/[^a-z0-9]/g, '')
                                   .substring(0, 50);
            if (seen.has(key)) {
              return false;
            }
            seen.add(key);
            return true;
          });
        };
      }

      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ã€Œå›½éš›ã€ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ 
      setTimeout(() => {
        const nav = document.querySelector('.nav');
        if (nav && !document.querySelector('[data-category="world"]')) {
          const worldLink = document.createElement('a');
          worldLink.href = '#';
          worldLink.className = 'nav-item';
          worldLink.dataset.category = 'world';
          worldLink.textContent = 'å›½éš›';
          
          worldLink.addEventListener('click', (e) => {
            e.preventDefault();
            newsHub.selectCategory('world');
          });
          
          nav.appendChild(worldLink);
          console.log('ğŸŒ Added "å›½éš›" category to navigation');
        }
      }, 3000);
      
      console.log('ğŸŒ Guardian & Reddit integration completed');
      
      // åˆæœŸèª­ã¿è¾¼ã¿ã‚’å†å®Ÿè¡Œ
      setTimeout(() => {
        newsHub.refreshDashboard();
      }, 1000);
      
    } else {
      console.log('â³ Waiting for integratedNewsHub to initialize...');
      
      // 5ç§’å¾Œã«å†è©¦è¡Œ
      setTimeout(() => {
        if (window.integratedNewsHub) {
          // ä¸Šè¨˜ã¨åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ
          window.integratedNewsHub.guardianRedditSystem = new GuardianRedditNewsSystem();
          console.log('ğŸŒ Guardian & Reddit integration completed (delayed)');
        }
      }, 5000);
    }

    console.log('ğŸ›ï¸ğŸ’¬ Guardian & Reddit API system loaded');
    
        </script>
        </body>
</html>